language: python

python:
  - "3.6"

env:
  global:
    - EPANET_HOME=`pwd`
    - BUILD_HOME=buildproducts
    - TEST_HOME=nrtestsuite

before_install:
  - sudo apt-get -qq update
  - sudo apt-get install -y libboost-test-dev swig
  - pip install pipenv

#install:

before_script:
  - mkdir -p $BUILD_HOME
  - cd $BUILD_HOME
  - cmake .. -DBUILD_TESTS=1

script:
  - cmake --build .
  # run unit tests
  - cd tests/unit
  - ctest
  # run regression tests
  - cd $EPANET_HOME/tests/regression
  - pipenv install
  - pipenv run python3 run_test.py $TEST_HOME 2012gcc 1.0.1 $TRAVIS_COMMIT $EPANET_HOME/$BUILD_HOME/bin/runepanet
