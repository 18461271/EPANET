language: python

python:
  - "3.6"

env:
  global:
    - EPANET_HOME=`pwd`
    - BUILD_HOME=buildproducts
    - TEST_HOME=nrtestsuite

before_install:
  - sudo apt-get -qq update
  - sudo apt-get install -y libboost-test-dev
  - sudo apt-get install libpcre3-dev
  - wget -O swig-3.0.12.tar.gz https://downloads.sourceforge.net/project/swig/swig/swig-3.0.12/swig-3.0.12.tar.gz?r=https%3A%2F%2Fsourceforge.net%2Fprojects%2Fswig%2Ffiles%2Fswig%2Fswig-3.0.12%2Fswig-3.0.12.tar.gz%2Fdownload&ts=1486782132&use_mirror=superb-sea2
  - tar xf swig-3.0.12.tar.gz
  - cd swig-3.0.12
  - ./configure --prefix=/usr && make -j 4 && sudo make install
  - pip install pipenv

#install:

before_script:
  - mkdir -p $BUILD_HOME
  - cd $BUILD_HOME
  - cmake .. -DBUILD_TESTS=1

script:
  - cmake --build .
  # run unit tests
  - cd tests/unit
  - ctest
  # run regression tests
  - cd $EPANET_HOME/tests/regression
  - pipenv install
  - pipenv run python3 run_test.py $TEST_HOME 2012gcc 1.0.1 $TRAVIS_COMMIT $EPANET_HOME/$BUILD_HOME/bin/runepanet
